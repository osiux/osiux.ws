---
import { Icon } from 'astro-icon/components';

const pathname = new URL(Astro.request.url).pathname;

console.log(pathname);

const linkClass = (isActive: boolean) => {
	const base = 'px-3 py-1 text-gray-600 dark:text-gray-400! hover:text-gray-900! dark:hover:text-gray-100! transition-colors';
	const active = 'text-gray-900! dark:text-white! font-medium underline decoration-2 underline-offset-4';
	return isActive ? `${base} ${active}` : base;
};
---

<script>
	const menu = document.getElementById('nav-menu');

	const toggleTheme = () => {
		const currentTheme =
			document.documentElement.attributes.getNamedItem(
				'data-theme',
			)?.value;

		document.dispatchEvent(
			new CustomEvent('set-theme', {
				detail: currentTheme === 'light' ? 'dark' : 'light',
			}),
		);
	};

	const openMenu = () => {
	const toggleButton = document.getElementById('toggle-menu');
		menu?.classList.toggle('flex');
		menu?.classList.toggle('hidden');
		toggleButton?.classList.toggle('is-open');
		toggleButton?.classList.toggle('is-closed');
	};

	const attachEvents = () => {
	const toggleButton = document.getElementById('toggle-menu');
		document
			.getElementById('toggle-theme')
			?.addEventListener('click', toggleTheme);
		toggleButton?.addEventListener('click', openMenu);
	};

	const detachEvents = () => {
	const toggleButton = document.getElementById('toggle-menu');
		document
			.getElementById('toggle-theme')
			?.removeEventListener('click', toggleTheme);
		toggleButton?.removeEventListener('click', openMenu);
	};

	attachEvents();

	document.addEventListener('astro:before-swap', detachEvents);
	document.addEventListener('astro:after-swap', attachEvents);
</script>

<header class="w-full font-heading bg-white dark:bg-[#1a1a1a]! border-b border-gray-100 dark:border-gray-800!">
	<nav
		class="max-w-3xl mx-auto w-full flex items-center flex-wrap md:max-w-4xl md:flex-nowrap py-6"
	>
		<a
			href="/"
			class="font-sans font-semibold text-gray-900 text-2xl flex-1 dark:text-white! ml-2 md:ml-0 tracking-tight"
		>
			Eduardo Reveles
		</a>
		<button
			class="bg-transparent inline-flex p-2 ml-auto outline-none focus:outline-none md:order-3 text-gray-600 dark:text-gray-400! hover:text-gray-900 dark:hover:text-gray-100! transition-colors"
			role="button"
			aria-label="Toggle Dark Mode"
			id="toggle-theme"
		>
			<Icon name="fa6-solid:sun" class="hidden dark:inline-block w-5 h-5" />
			<Icon name="fa6-solid:moon" class="inline-block dark:hidden w-5 h-5" />
		</button>
		<button
			class="inline-flex p-2 rounded md:hidden ml-2 outline-none focus:outline-none group is-closed text-gray-600 dark:text-gray-400!"
			role="button"
			aria-label="Toggle Menu"
			id="toggle-menu"
		>
			<Icon
				name="fa6-solid:bars"
				class="group-[.is-open]:hidden group-[.is-closed]:inline-block w-5 h-5"
			/>
			<Icon
				name="fa6-solid:xmark"
				class="group-[.is-open]:inline-block group-[.is-closed]:hidden w-5 h-5"
			/>
		</button>
		<ul
			id="nav-menu"
			class="hidden flex-col items-center justify-center flex-none w-full place-items-center md:flex md:flex-row md:w-auto md:gap-1"
		>
			<li class="my-3 md:my-0">
				<a
					class={linkClass(pathname.startsWith('/blog'))}
					href="/blog"
				>
					Blog
				</a>
			</li>
			<li class="my-3 md:my-0">
				<a
					class={linkClass(pathname.startsWith('/about'))}
					href="/about"
				>
					About
				</a>
			</li>
			<li class="my-3 md:my-0">
				<a
					class={linkClass(pathname === '/contact')}
					href="/contact"
				>
					Contact
				</a>
			</li>
		</ul>
	</nav>
</header>
